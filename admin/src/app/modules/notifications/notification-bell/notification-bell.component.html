<div class="notif-bell-wrapper" [class.open]="open">

    <!-- Bell Button -->
    <button class="notif-bell-btn" (click)="togglePanel()" [class.has-unread]="unreadCount > 0">
        <i class="fas fa-bell"></i>
        <span class="notif-badge" *ngIf="unreadCount > 0">{{ unreadCount > 99 ? '99+' : unreadCount }}</span>
    </button>

    <!-- Dropdown Panel -->
    <div class="notif-panel" *ngIf="open" (click)="$event.stopPropagation()">
        <div class="notif-panel-header">
            <h4>ðŸ”” Notificaciones</h4>
            <div class="notif-header-actions">
                <button (click)="markAllRead()" *ngIf="unreadCount > 0" class="btn-mark-all">
                    âœ“ Marcar todas
                </button>
                <a routerLink="/notifications/send" class="btn-send-icon" *ngIf="isAdmin || isCompanyAdmin"
                    (click)="open = false" title="Enviar notificaciÃ³n">
                    <i class="fas fa-paper-plane"></i>
                </a>
            </div>
        </div>

        <!-- Loading -->
        <div class="notif-loading" *ngIf="loading">
            <div class="mini-spinner"></div>
        </div>

        <!-- Empty -->
        <div class="notif-empty" *ngIf="!loading && notifications.length === 0">
            <i class="fas fa-bell-slash"></i>
            <p>Sin notificaciones</p>
        </div>

        <!-- Notification Items -->
        <div class="notif-list" *ngIf="!loading && notifications.length > 0">
            <div class="notif-item" *ngFor="let n of notifications" [class.unread]="!n.is_read"
                (click)="onClickNotif(n)">
                <div class="notif-icon-wrap" [style.background]="n.color || '#6366f1'">
                    <i [class]="n.icon || 'fas fa-bell'"></i>
                </div>
                <div class="notif-content">
                    <div class="notif-title">{{ n.title }}</div>
                    <div class="notif-msg">{{ n.message }}</div>
                    <div class="notif-time">{{ timeAgo(n.created_at) }}</div>
                </div>
                <button class="notif-delete" (click)="deleteNotif(n, $event)" title="Eliminar">Ã—</button>
            </div>
        </div>

        <div class="notif-panel-footer" *ngIf="notifications.length > 0">
            <button (click)="open = false" class="btn-close-panel">Cerrar</button>
        </div>
    </div>

</div>