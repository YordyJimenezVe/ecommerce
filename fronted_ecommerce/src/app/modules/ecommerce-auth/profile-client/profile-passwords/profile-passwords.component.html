<div class="acprof_info_wrap">
    <h4 class="text_xl mb-4 font-weight-bolder" style="color: var(--text-color, #333);">{{ 'Security Settings' |
        translate }}</h4>
    <p class="text-muted mb-4">{{ 'Update your password and manage account security.' | translate }}</p>

    <form action="">
        <div class="row">
            <div class="col-md-12 mb-3">
                <div class="single_billing_inp">
                    <label class="font-weight-500 mb-2"><i class="las la-unlock-alt"
                            style="color: #f89c0e; font-size: 1.1rem; margin-right: 5px;"></i>{{ 'Current Password' |
                        translate }}</label>
                    <div class="position-relative">
                        <input type="password" [placeholder]="'Enter current password' | translate"
                            [(ngModel)]="current_password" name="current_password" class="form-control"
                            style="border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); padding: 12px;">
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="single_billing_inp">
                    <label class="font-weight-500 mb-2"><i class="las la-lock"
                            style="color: #f89c0e; font-size: 1.1rem; margin-right: 5px;"></i>{{ 'New Password' |
                        translate }}</label>
                    <div class="position-relative">
                        <input type="password" [placeholder]="'Enter new password' | translate"
                            [(ngModel)]="new_password" name="new_password" class="form-control"
                            style="border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); padding: 12px;">
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="single_billing_inp">
                    <label class="font-weight-500 mb-2"><i class="las la-check-circle"
                            style="color: #f89c0e; font-size: 1.1rem; margin-right: 5px;"></i>{{ 'Confirm New Password'
                        | translate }}</label>
                    <div class="position-relative">
                        <input type="password" [placeholder]="'Repeat your new password' | translate"
                            [(ngModel)]="repeat_password" name="repeat_password" class="form-control"
                            style="border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); padding: 12px;">
                    </div>
                </div>
            </div>
            <div class="col-12 mt-2 mb-5">
                <button type="submit" class="default_btn rounded" (click)="save()" style="padding: 12px 30px;">
                    <i class="las la-key mr-2"></i> {{ 'Change Password' | translate }}
                </button>
            </div>
        </div>
    </form>

    <!-- 2FA Options -->
    <hr style="border-color: rgba(0,0,0,0.05); margin: 30px 0;">
    <h4 class="text_xl mb-3 font-weight-bolder" style="color: var(--text-color, #333);">{{ 'Two-Factor Authentication
        (2FA)' | translate }}</h4>
    <div class="p-4"
        style="background: rgba(var(--primary-color-rgb, 137, 80, 252), 0.05); border: 1px solid rgba(var(--primary-color-rgb, 137, 80, 252), 0.1); border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-1 text-dark" style="font-size: 1.1rem;">{{ 'Secure Your Account' | translate }}</h5>
                <p class="text-muted mb-0" style="font-size: 0.9rem;">{{ 'Add an extra layer of security to your account
                    by enabling 2FA.' | translate }}</p>
            </div>
            <div class="custom-control custom-switch custom-switch-primary">
                <input type="checkbox" class="custom-control-input" id="customSwitch2FA" [checked]="is2FAEnabled"
                    (change)="toggle2FA()">
                <label class="custom-control-label" for="customSwitch2FA" style="cursor: pointer; font-weight: 500;">
                    <span *ngIf="is2FAEnabled" class="text-success">{{ 'Enabled' | translate }}</span>
                    <span *ngIf="!is2FAEnabled" class="text-secondary">{{ 'Disabled' | translate }}</span>
                </label>
            </div>
        </div>

        <!-- Setup 2FA Block -->
        <div class="mt-4 pt-4 border-top" *ngIf="isGenerating2FA" style="border-color: rgba(0,0,0,0.05) !important;">
            <h5 class="text-dark mb-3">{{ 'Set up Google Authenticator' | translate }}</h5>

            <div class="row">
                <div class="col-md-5 text-center mb-4">
                    <p class="text-muted text-sm mb-2">{{ '1. Scan this QR code with your Authenticator app.' |
                        translate }}</p>
                    <div class="qr-container bg-white p-2 d-inline-block rounded shadow-sm mb-2" *ngIf="qrCodeSvg"
                        [innerHTML]="qrCodeSvg | safeHtml">
                    </div>
                    <!-- Fallback if not using a safeHtml pipe, we use an img if it's base64, but the API sends base64. Let's adjust binding safely: -->
                    <img *ngIf="qrCodeSvg" [src]="'data:image/svg+xml;base64,' + qrCodeSvg" alt="QR Code"
                        class="img-fluid rounded" style="max-width: 200px;" />

                    <p class="text-muted text-xs mt-2 mb-0">{{ 'Or enter code manually:' | translate }}</p>
                    <code class="d-block mt-1 font-weight-bolder text-dark p-2 rounded"
                        style="background:#f4f4f4;">{{ secretKey }}</code>
                </div>

                <div class="col-md-7">
                    <p class="text-muted text-sm mb-3">{{ '2. Enter the 6-digit code generated by your app.' | translate
                        }}</p>

                    <div class="form-group mb-4">
                        <label class="font-weight-500 mb-2">{{ 'Verification Code' | translate }}</label>
                        <input type="text" class="form-control"
                            style="border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); padding: 12px; font-size: 1.2rem; letter-spacing: 5px; text-align: center;"
                            placeholder="000000" maxlength="6" [(ngModel)]="verificationCode" name="verificationCode">
                    </div>

                    <div class="d-flex align-items-center">
                        <button type="button" class="default_btn rounded mr-3" style="padding: 10px 25px;"
                            (click)="verifyAndEnable2FA()">
                            <i class="las la-check-circle mr-1"></i> {{ 'Verify & Enable' | translate }}
                        </button>
                        <button type="button" class="btn btn-light-danger font-weight-bold rounded"
                            style="padding: 10px 20px;" (click)="cancel2FASetup()">
                            {{ 'Cancel' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active 2FA Info -->
        <div class="mt-4 pt-3 border-top" *ngIf="is2FAEnabled && !isGenerating2FA"
            style="border-color: rgba(0,0,0,0.05) !important;">
            <p class="text-success font-weight-bold mb-2"><i class="las la-check-circle mr-1"></i> {{ '2FA is active.' |
                translate }}</p>
            <p class="text-muted text-sm">{{ 'You will be asked for a verification code when signing in from
                unrecognized devices.' | translate }}</p>
        </div>
    </div>
</div>